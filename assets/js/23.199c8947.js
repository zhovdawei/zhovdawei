(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{379:function(a,s,t){"use strict";t.r(s);var n=t(42),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"综合实战-可视化分析elasticsearch查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#综合实战-可视化分析elasticsearch查询"}},[a._v("#")]),a._v(" 综合实战-可视化分析Elasticsearch查询")]),a._v(" "),t("hr"),a._v(" "),t("h2",{attrs:{id:"目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[a._v("#")]),a._v(" 目标")]),a._v(" "),t("p",[a._v("本次实战的目标：用Packetbeat收集执行在Elasticsearch上的查询请求的网络包，\n然后在Logstash上对数据过滤，最后在Kibana上对数据做可视化分析。")]),a._v(" "),t("h2",{attrs:{id:"实现分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现分析"}},[a._v("#")]),a._v(" 实现分析")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/elkb/all1.png",alt:""}}),t("br")]),a._v(" "),t("h3",{attrs:{id:"节点192-168-163-114"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#节点192-168-163-114"}},[a._v("#")]),a._v(" 节点192.168,163.114")]),a._v(" "),t("p",[a._v("部署Kibana+Elasticsearch+Packetbeat。在Kibana上查询数据，请求发往本机的Elasticsearch,然后\nPacketbeat抓包请求的全部数据，然后将数据发往115上的Logstash。")]),a._v(" "),t("h3",{attrs:{id:"节点192-168-163-115"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#节点192-168-163-115"}},[a._v("#")]),a._v(" 节点192.168,163.115")]),a._v(" "),t("p",[a._v("部署Kibana+Elasticsearch+Logstash。Logstash获得来自114的抓包数据，解析过滤封成结构型数据，\n然后发送到本机的Elastcisearch存储起来。最后在本机的Kibana上检索出这些数据，再做可视化分析，制作\n成图/表/折线。")]),a._v(" "),t("h3",{attrs:{id:"注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[a._v("#")]),a._v(" 注意事项")]),a._v(" "),t("p",[a._v("两台Elasticsearch不能在同一个集群内，否则会导致一个请求过来，抓包后的数据又发往集群，造成循环抓包。\n最后造成集群主机性能压力过大，最终卡死。")]),a._v(" "),t("h2",{attrs:{id:"准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[a._v("#")]),a._v(" 准备")]),a._v(" "),t("h3",{attrs:{id:"节点192-168-163-114-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#节点192-168-163-114-2"}},[a._v("#")]),a._v(" 节点192.168,163.114")]),a._v(" "),t("p",[a._v("1.启动Elasticsearch"),t("br"),a._v("\n配置参考前面"),t("a",{attrs:{href:"/coding/database/elasticstack/Centos7%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85ElasticSearch"}},[a._v("Elasticsearch安装篇")]),t("br"),a._v(" "),t("img",{attrs:{src:"/images/elkb/all2.png",alt:""}}),t("br")]),a._v(" "),t("p",[a._v("2.启动Kibana"),t("br"),a._v("\n配置参考前面"),t("a",{attrs:{href:"/coding/database/elasticstack/Centos7%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85Kibana"}},[a._v("Kibana安装篇")]),a._v(" "),t("img",{attrs:{src:"/images/elkb/all3.png",alt:""}}),t("br")]),a._v(" "),t("p",[a._v("3.启动Packetbeat"),t("br"),a._v("\n捕捉本地网络包，发送到115上的Logstash")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('# 创建文件elkb.yml\n# 编辑文件\n[root@host114 packetbeat-7.5.0-linux-x86_64]# vi elkb.yml \n#######################################################################\npacketbeat.interfaces.device: any\n\npacketbeat.protocols.http:\n  ports: [9200]\n  send_request: true   \n  include_body_for: ["application/json", "x-www-form-urlencoded"]\n\noutput.logstash:\n    hosts: ["192.168.163.115:5044"]\n#######################################################################\n\n# 启动\n[root@host114 packetbeat-7.5.0-linux-x86_64]# sudo ./packetbeat -e -c elkb.yml -strict.perms=false\n...\n2020-01-16T00:23:50.028+0800\tINFO\tinstance/beat.go:429\tpacketbeat start running.\n2020-01-16T00:23:51.533+0800\tINFO\tpipeline/output.go:95\tConnecting to backoff(async(tcp://192.168.163.115:5044))\n2020-01-16T00:23:51.534+0800\tINFO\tpipeline/output.go:105\tConnection to backoff(async(tcp://192.168.163.115:5044)) established\n\n# 注意：packetbeat要晚于logstash启动，请看上面的打印，packetbeat启动需要与logstash建立连接。\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br")])]),t("h3",{attrs:{id:"节点192-168-163-114-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#节点192-168-163-114-3"}},[a._v("#")]),a._v(" 节点192.168,163.114")]),a._v(" "),t("p",[a._v("1.启动Elasticsearch"),t("br"),a._v("\n配置参考前面"),t("a",{attrs:{href:"/coding/database/elasticstack/Centos7%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85ElasticSearch"}},[a._v("Elasticsearch安装篇")]),t("br"),a._v(" "),t("img",{attrs:{src:"/images/elkb/all5.png",alt:""}}),t("br")]),a._v(" "),t("p",[a._v("2.启动Kibana"),t("br"),a._v("\n配置参考前面"),t("a",{attrs:{href:"/coding/database/elasticstack/Centos7%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85Kibana"}},[a._v("Kibana安装篇")]),a._v(" "),t("img",{attrs:{src:"/images/elkb/all6.png",alt:""}}),t("br")]),a._v(" "),t("p",[a._v("3.启动Logstash"),t("br")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('# 创建配置文件elkb.conf\n# 编辑文件\n[root@host115 logstash-7.5.0]# vi elkb.conf \n#######################################################################\ninput {\n    beats {\n        port => 5044\n    }\n}\nfilter {\n    if "search" in [request]{\n        grok {\n            match => { "request" => ".*\\n\\{(?<query_body>.*)"} \n        }\n        grok {\n            match => { "path" => "\\/(?<index>.*)\\/_search"}     \n        }\n     if [index] {\n      } else {\n            mutate {\n              add_field  => { "index" => "All" }\n        }\n      }\n\n      mutate {\n              update  => { "query_body" => "{%{query_body}"}}\n      }\n\n}\n\noutput {\n  #stdout{codec=>rubydebug}\n\n  if "search" in [request]{\n        elasticsearch {\n        hosts => "192.168.162.115:9200"\n        }\n   }\n}\n\n#######################################################################\n\n# 启动\n[root@host115 logstash-7.5.0]# bin/logstash -f elkb.conf \n...\n[2020-01-16T00:18:52,194][INFO ][org.logstash.beats.Server][main] Starting server on port: 5044\n[2020-01-16T00:18:52,836][INFO ][logstash.agent           ] Successfully started Logstash API endpoint {:port=>9600}\n\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br"),t("span",{staticClass:"line-number"},[a._v("35")]),t("br"),t("span",{staticClass:"line-number"},[a._v("36")]),t("br"),t("span",{staticClass:"line-number"},[a._v("37")]),t("br"),t("span",{staticClass:"line-number"},[a._v("38")]),t("br"),t("span",{staticClass:"line-number"},[a._v("39")]),t("br"),t("span",{staticClass:"line-number"},[a._v("40")]),t("br"),t("span",{staticClass:"line-number"},[a._v("41")]),t("br"),t("span",{staticClass:"line-number"},[a._v("42")]),t("br"),t("span",{staticClass:"line-number"},[a._v("43")]),t("br"),t("span",{staticClass:"line-number"},[a._v("44")]),t("br"),t("span",{staticClass:"line-number"},[a._v("45")]),t("br"),t("span",{staticClass:"line-number"},[a._v("46")]),t("br"),t("span",{staticClass:"line-number"},[a._v("47")]),t("br"),t("span",{staticClass:"line-number"},[a._v("48")]),t("br")])]),t("h2",{attrs:{id:"可视化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可视化"}},[a._v("#")]),a._v(" 可视化")]),a._v(" "),t("h3",{attrs:{id:"在115上查看logstash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在115上查看logstash"}},[a._v("#")]),a._v(" 在115上查看logstash")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/elkb/all7.png",alt:""}}),t("br")]),a._v(" "),t("h3",{attrs:{id:"创建index-pattern"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建index-pattern"}},[a._v("#")]),a._v(" 创建index pattern")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/elkb/all8.png",alt:""}}),t("br")]),a._v(" "),t("h3",{attrs:{id:"勾选你关心的字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#勾选你关心的字段"}},[a._v("#")]),a._v(" 勾选你关心的字段")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/elkb/all9.png",alt:""}}),t("br")]),a._v(" "),t("h3",{attrs:{id:"在114上发起查询请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在114上发起查询请求"}},[a._v("#")]),a._v(" 在114上发起查询请求")]),a._v(" "),t("p",[a._v("多发起几次请求，然后回到115上，刷新页面，我们就可以看到刚刚在114上的请求已经展示出来了。\n"),t("img",{attrs:{src:"/images/elkb/all10.png",alt:""}}),t("br")]),a._v(" "),t("h3",{attrs:{id:"根据字段划分-饼图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#根据字段划分-饼图"}},[a._v("#")]),a._v(" 根据字段划分-饼图")]),a._v(" "),t("p",[a._v("我们可以选择根据-url.path.keyword这个属性来制作饼图，看看各请求的占比情况。\n"),t("img",{attrs:{src:"/images/elkb/all11.png",alt:""}}),t("br")]),a._v(" "),t("h2",{attrs:{id:"小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[a._v("#")]),a._v(" 小结")]),a._v(" "),t("p",[a._v("目前为止笔者也算入门ElasticStack技术栈，它是如此好用与方便。后面继续学习研究这个技术栈的各种细节。\n干就完了，奥利给。")])])}),[],!1,null,null,null);s.default=e.exports}}]);