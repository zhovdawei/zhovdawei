(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{393:function(s,a,n){"use strict";n.r(a);var t=n(42),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"docker数据卷管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker数据卷管理"}},[s._v("#")]),s._v(" docker数据卷管理")]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"将docker主机数据挂载到容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#将docker主机数据挂载到容器"}},[s._v("#")]),s._v(" 将Docker主机数据挂载到容器")]),s._v(" "),n("p",[s._v("Docker提供三种不同的方式将数据从宿主机挂载到容器中：volumes，bind mounts和tmpfs。"),n("br"),s._v("\nvolumes：Docker管理宿主机文件系统的一部分（/var/lib/docker/volumes）。"),n("br"),s._v("\nbind mounts：可以存储在宿主机系统的任意位置。"),n("br"),s._v("\ntmpfs：挂载存储在宿主机系统的内存中，而不会写入宿主机的文件系统。"),n("br"),s._v(" "),n("img",{attrs:{src:"/images/docker/docker18.png",alt:""}})]),s._v(" "),n("h2",{attrs:{id:"volume数据卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#volume数据卷"}},[s._v("#")]),s._v(" volume数据卷")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/docker/docker19.png",alt:""}}),n("br")]),s._v(" "),n("h3",{attrs:{id:"管理卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#管理卷"}},[s._v("#")]),s._v(" 管理卷：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# docker volume create nginx-vol\n# docker volume ls\n# docker volume inspect nginx-vol\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"用卷创建一个容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用卷创建一个容器"}},[s._v("#")]),s._v(" 用卷创建一个容器：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#命令解析\n# docker run -> docker创建并运行一个容器\n# -d -it 后端交互式运行\n# --name -> 命名容器名\n# --mount -> 挂载文件\n# src=nginx-vol 宿主机目录(/var/lib/docker/volumes/)下的nginx-vol，没有就创建\n# dst=/usr/share/nginx/html 上面的数据卷文件挂载到容器内的/usr/share/nginx/html目录\n# nginx 镜像名\n# docker run -d -it --name=nginx-test --mount src=nginx-vol,dst=/usr/share/nginx/html nginx\n\n\n# docker run -d -it --name=nginx-test -v nginx-vol:/usr/share/nginx/html nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"清理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#清理"}},[s._v("#")]),s._v(" 清理：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# docker container stop nginx-test\n# docker container rm nginx-test \n# docker volume rm nginx-vol\n\n# 删除所有的容器\n# docker rm -f $(docker ps -q -a)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 将宿主机的端口8081映射到容器ngx的80端口\n# docker run -d -it --name=ngx -p 8081:80 --mount src=nginx-vol,dst=/usr/share/nginx/html nginx\n# 在宿主机数据卷中增加一个文件 a.html\n# cd /var/lib/docker/volumes/nginx-vol/_data\n# vi a.html\n######################################\n# 文件中加入如下字符串\n# <h1>hello nginx!!!</h1>\n######################################\n\n# 起多个容器访问同一个数据卷，实现数据的共享，实现应用的负载\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("浏览器访问http://192.168.163.106:8081/a.html，使用你自己的宿主机ip\n"),n("img",{attrs:{src:"/images/docker/docker20.png",alt:""}}),n("br")]),s._v(" "),n("h3",{attrs:{id:"注意"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[s._v("#")]),s._v(" 注意：")]),s._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),n("p",[s._v("如果没有指定卷，自动创建一个匿名的数据卷，也在目录**/var/lib/docker/volumes**中。"),n("br"),s._v("\n建议使用—mount，更通用。"),n("br")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/storage/volumes/",target:"_blank",rel:"noopener noreferrer"}},[s._v("volume官方文档"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"bind-mounts绑定挂载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bind-mounts绑定挂载"}},[s._v("#")]),s._v(" Bind Mounts绑定挂载")]),s._v(" "),n("h3",{attrs:{id:"用卷创建一个容器-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用卷创建一个容器-2"}},[s._v("#")]),s._v(" 用卷创建一个容器：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# docker run -d -it --name=nginx-test --mount type=bind,src=/app/wwwroot,dst=/usr/share/nginx/html nginx\n# docker run -d -it --name=nginx-test -v /app/wwwroot:/usr/share/nginx/html nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"验证绑定"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#验证绑定"}},[s._v("#")]),s._v(" 验证绑定：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# docker inspect nginx-test\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"清理-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#清理-2"}},[s._v("#")]),s._v(" 清理：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# docker container stop nginx-test \n# docker container rm nginx-test \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[s._v("#")]),s._v(" 使用场景：")]),s._v(" "),n("p",[s._v("将宿主机target/*.war *.jar 挂载到tomcat下的webapp/实现部署")]),s._v(" "),n("h3",{attrs:{id:"注意-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意-2"}},[s._v("#")]),s._v(" 注意：")]),s._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),n("p",[s._v("如果源文件/目录没有存在，不会自动创建，会抛出一个错误。"),n("br"),s._v("\n如果挂载目标在容器中对应的目录不是空目录，则容器中的目录现有的内容将被隐藏。"),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);