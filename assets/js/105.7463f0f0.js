(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{462:function(a,s,e){"use strict";e.r(s);var t=e(42),r=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"rabbitmq进阶一之消息持久化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq进阶一之消息持久化"}},[a._v("#")]),a._v(" RabbitMQ进阶一之消息持久化")]),a._v(" "),e("hr"),a._v(" "),e("h2",{attrs:{id:"消息队列的构造参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#消息队列的构造参数"}},[a._v("#")]),a._v(" 消息队列的构造参数")]),a._v(" "),e("p",[a._v("看消息队列的构造器，就已经很明显了。durable这个单词就是耐用持久的意思。那么我们关注的消息持久化就是跟这个参数有关。\n其实这个Queue还有一个默认的构造器，是默认持久消息的。不过我们先演示下非持久消息，看看是什么效果。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("/**\n * @param name the name of the queue.\n * @param durable true if we are declaring a durable queue (the queue will survive a server restart)\n */\npublic Queue(String name, boolean durable) {\n    this(name, durable, false, false, null);\n}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br")])]),e("h2",{attrs:{id:"测试非持久消息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试非持久消息"}},[a._v("#")]),a._v(" 测试非持久消息")]),a._v(" "),e("h3",{attrs:{id:"构造非持久消息队列"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构造非持久消息队列"}},[a._v("#")]),a._v(" 构造非持久消息队列")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('@Bean\npublic Queue persistentQueue(){\n    /**\n     * Queue构造器参数\n     * @name 队列的命名\n     * @durable true-消息重启后还存在；false-重启后不存在\n     */\n    return new Queue("PersistentQueue",false);\n}\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br")])]),e("h3",{attrs:{id:"发送消息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发送消息"}},[a._v("#")]),a._v(" 发送消息")]),a._v(" "),e("p",[a._v("好了，成功往这个队列里面发了三条消息\n"),e("img",{attrs:{src:"/images/rabbitmq/queue-1.png",alt:""}}),e("br")]),a._v(" "),e("h3",{attrs:{id:"重启rabbitmq服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重启rabbitmq服务"}},[a._v("#")]),a._v(" 重启rabbitmq服务")]),a._v(" "),e("p",[a._v("这里就很明显了，连队列都一起删除了。这下全懂了，所谓的消息持久化，不是消息持久存储在队列里面，而是消息队列本身的持久化。如果消息队列\n不是持久化属性，那么重启后，队列不存在了，就更别提队列中的消息了。\n"),e("img",{attrs:{src:"/images/rabbitmq/queue-2.png",alt:""}}),e("br")]),a._v(" "),e("h2",{attrs:{id:"测试持久化队列"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试持久化队列"}},[a._v("#")]),a._v(" 测试持久化队列")]),a._v(" "),e("h3",{attrs:{id:"构造持久化消息队列"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构造持久化消息队列"}},[a._v("#")]),a._v(" 构造持久化消息队列")]),a._v(" "),e("p",[a._v("这里注意，不显示设置durable属性的构造器，内部是默认为true的。意思就是默认构造的就是持久化队列。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('@Bean\npublic Queue persistentQueue(){\n    /**\n     * Queue构造器参数\n     * @name 队列的命名\n     * 不显示设置druable的队列，默认是持久化\n     */\n    return new Queue("PersistentQueue");\n}\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br")])]),e("h3",{attrs:{id:"发送消息和重启服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发送消息和重启服务"}},[a._v("#")]),a._v(" 发送消息和重启服务")]),a._v(" "),e("p",[a._v("这里就不多截图了，持久化的队列，重启后，队列都和消息都在。\n"),e("img",{attrs:{src:"/images/rabbitmq/queue-3.png",alt:""}}),e("br")]),a._v(" "),e("h3",{attrs:{id:"放开消费者测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#放开消费者测试"}},[a._v("#")]),a._v(" 放开消费者测试")]),a._v(" "),e("p",[a._v("成功把重启后的服务器上的消息，消费掉。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[消费者] 持久化消息队列 => 新消息753\n[消费者] 持久化消息队列 => 新消息910\n[消费者] 持久化消息队列 => 新消息225\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);