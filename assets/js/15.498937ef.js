(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{369:function(s,a,t){"use strict";t.r(a);var n=t(42),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"beats入门介绍和使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#beats入门介绍和使用"}},[s._v("#")]),s._v(" Beats入门介绍和使用")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"几种beats"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#几种beats"}},[s._v("#")]),s._v(" 几种Beats")]),s._v(" "),t("p",[s._v("官方介绍Beats为轻量级的数据采集器。"),t("br"),s._v(" "),t("strong",[s._v("Filebeat")]),s._v(" 日志文件"),t("br"),s._v(" "),t("strong",[s._v("Metricbeat")]),s._v(" 度量数据(主机的CPU,内存等使用情况，应用的监控指标)"),t("br"),s._v(" "),t("strong",[s._v("Packetbeat")]),s._v(" 网络数据(抓包)"),t("br"),s._v(" "),t("strong",[s._v("Winlogbeat")]),s._v(" windows系统上的数据"),t("br"),s._v(" "),t("strong",[s._v("Heartbeat")]),s._v(" 健康检查"),t("br"),s._v(" "),t("img",{attrs:{src:"/images/elkb/beat1.png",alt:""}}),t("br")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"filebeat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filebeat"}},[s._v("#")]),s._v(" Filebeat")]),s._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("版本：7.5.0 Linux 64位"),t("br"),s._v("\n1.上传安装包")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@host114 tool]# rz\n\n[root@host114 tool]# ll\ntotal 539936\n-rw-r--r--. 1 root root 290113992 Jan 13 16:09 elasticsearch-7.5.0-linux-x86_64.tar.gz\n-rw-r--r--  1 root root  24313058 Jan 13 15:34 filebeat-7.5.0-linux-x86_64.tar.gz\n-rw-r--r--. 1 root root 238464690 Jan 13 15:35 kibana-7.5.0-linux-x86_64.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("2.解压到指定目录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@host114 tool]# tar zxvf filebeat-7.5.0-linux-x86_64.tar.gz \n[root@host114 tool]# mv filebeat-7.5.0-linux-x86_64 /usr/local/\n[root@host114 local]# cd filebeat-7.5.0-linux-x86_64/\n[root@host114 filebeat-7.5.0-linux-x86_64]# ll\ntotal 74788\n-rw-r--r--  1 root root   316785 Nov 26 08:06 fields.yml\n-rwxr-xr-x  1 root root 75830544 Nov 26 08:07 filebeat\n-rw-r--r--  1 root root    83274 Nov 26 08:06 filebeat.reference.yml\n-rw-------  1 root root     8236 Nov 26 08:06 filebeat.yml\ndrwxr-xr-x  3 root root       15 Nov 26 08:06 kibana\n-rw-r--r--  1 root root    13675 Nov 26 07:26 LICENSE.txt\ndrwxr-xr-x 38 root root     4096 Nov 26 08:06 module\ndrwxr-xr-x  2 root root     4096 Nov 26 08:06 modules.d\n-rw-r--r--  1 root root   302830 Nov 26 07:27 NOTICE.txt\n-rw-r--r--  1 root root      802 Nov 26 08:08 README.md\n\n# filebeat.reference.yml 包含所有配置的模板，可供参考\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h3",{attrs:{id:"处理流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#处理流程"}},[s._v("#")]),s._v(" 处理流程")]),s._v(" "),t("p",[s._v("1.输入 input"),t("br"),s._v("\n2.处理 filter"),t("br"),s._v("\n3.输出 output"),t("br"),s._v(" "),t("img",{attrs:{src:"/images/elkb/filebeat1.png",alt:""}}),t("br"),s._v(" "),t("strong",[s._v("Prospector(勘探者)")]),s._v(" : filebeat可以配置多个prospector,每个prospector对应一种文件匹配\n规则。prospector能感知文件变化，进而触发harvester增量读取新的日志。"),t("br"),s._v(" "),t("strong",[s._v("Harvester(收割者)")]),s._v(" : 每一个日志文件对应一个harvester,harvester将数据取出来发给output.")]),s._v(" "),t("h3",{attrs:{id:"配置解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置解析"}},[s._v("#")]),s._v(" 配置解析")]),s._v(" "),t("p",[s._v("1.input配置(yaml)"),t("br"),s._v("\ninput_type: log(日志文件) / stdin(标准输入)"),t("br")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filebeat.prospectors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("input_type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" log\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      /var/log/apache/httpd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.log")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("input_type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" log\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /var/log/messages\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /var/log/"),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.log")]),s._v("\n        \n        \n\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("2.output配置(yaml)"),t("br"),s._v("\n支持的输出 : Console / Elasticsearch / Logstash / Kafka / Redis / File")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("output.elasticsearch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.163.114:9200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果es设置了用户")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"****"')]),s._v("  \n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("output.console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启json格式化输出")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pretty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("3.filter配置\n弱过滤器。"),t("br"),s._v("\ninput处理 : include_lines / exclude_lines / exclude_files"),t("br"),s._v("\noutput处理 : drop_event / drop_fields / decode_json_fields / include_fields"),t("br")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("processors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 过滤debug日志")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("drop_event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regesp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^DBG:"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("processors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对json中的inner字段的值，做json转换")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("decode_json_fields")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fields")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"inner"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"高级用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高级用法"}},[s._v("#")]),s._v(" 高级用法")]),s._v(" "),t("p",[s._v("1.Elasticsearch Ingest Node"),t("br"),s._v("\n由于filebeat 缺乏数据转换能力，官方提供了ingest node。它是新的的node类型，可以在数据写入es前\n对数据进行处理。它使用pipeline api。")]),s._v(" "),t("p",[s._v("2.Filebeat Module"),t("br"),s._v("\nfilebeat把数据写入es要做一些配置文件的合理配置，还有ingest node中pipeline配置，还要对数据做\n合理的kibana dashboard的配置。由于这些步骤繁琐复杂，官方推出了封装好的module,把常用的日志格式做统一处理。\n比如：nginx / apache / mysql ..."),t("br")]),s._v(" "),t("h3",{attrs:{id:"实战nginx日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实战nginx日志"}},[s._v("#")]),s._v(" 实战Nginx日志")]),s._v(" "),t("p",[s._v("1.准备nginx日志")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# 下载安装ngnix,然后访问ngnix即可\n[root@host114 filebeat-7.5.0-linux-x86_64]# head -n 5 /var/log/nginx/access.log \n192.168.163.1 - - [15/Jan/2020:02:47:55 +0800] "GET / HTTP/1.1" 200 612 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36" "-"\n192.168.163.1 - - [15/Jan/2020:02:47:55 +0800] "GET /favicon.ico HTTP/1.1" 404 555 "http://192.168.163.114/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36" "-"\n192.168.163.1 - - [15/Jan/2020:02:50:33 +0800] "GET /50x.html HTTP/1.1" 200 494 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36" "-"\n192.168.163.1 - - [15/Jan/2020:02:51:36 +0800] "GET /test.html HTTP/1.1" 200 27 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36" "-"\n192.168.163.1 - - [15/Jan/2020:03:19:11 +0800] "GET /a.html HTTP/1.1" 404 555 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36" "-"\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("2.Filebeat配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 新增一个nginx.yml的配置文件\n# 这里配置的就是从标准输入中获得数据，并格式处理后输出到控制台\n[root@host114 filebeat-7.5.0-linux-x86_64]# vi nginx.yml \n####################################################################\nfilebeat.inputs: \n- input_type: stdin\n\noutput.console: \n    pretty: true\n####################################################################\n注意 : 本来是用filebeat.prospectors:配置的，但是在7.5.0这个版本提示我这个属性不存在。于是我查看了\n自带的官方配置，这里变成了 filebeat.inputs: 。于是替换为这个，就可以正常运行了。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("3.运行Filebeat")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# 启动后，就可以看到封装到JSON格式字串里的nginx日志了。\n[root@host114 filebeat-7.5.0-linux-x86_64]# head -n 5 /var/log/nginx/access.log|./filebeat -e -c nginx.yml \n...\n{\n  "@timestamp": "2020-01-14T19:37:45.068Z",\n  "@metadata": {\n    "beat": "filebeat",\n    "type": "_doc",\n    "version": "7.5.0"\n  },\n  "ecs": {\n    "version": "1.1.0"\n  },\n  "host": {\n    "name": "host114"\n  },\n  "agent": {\n    "type": "filebeat",\n    "ephemeral_id": "148cf326-9d93-4f29-bcb3-b4ce6fe3d5b4",\n    "hostname": "host114",\n    "id": "6f16e070-9e8c-4215-9b93-a6348ffce733",\n    "version": "7.5.0"\n  },\n  "log": {\n    "offset": 0,\n    "file": {\n      "path": ""\n    }\n  },\n  "message": "192.168.163.1 - - [15/Jan/2020:02:51:36 +0800] \\"GET /test.html HTTP/1.1\\" 200 27 \\"-\\" \\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36\\" \\"-\\""\n}\n{\n  "@timestamp": "2020-01-14T19:37:45.068Z",\n  "@metadata": {\n    "beat": "filebeat",\n    "type": "_doc",\n    "version": "7.5.0"\n  },\n  "agent": {\n    "ephemeral_id": "148cf326-9d93-4f29-bcb3-b4ce6fe3d5b4",\n    "hostname": "host114",\n    "id": "6f16e070-9e8c-4215-9b93-a6348ffce733",\n    "version": "7.5.0",\n    "type": "filebeat"\n  },\n  "ecs": {\n    "version": "1.1.0"\n  },\n  "host": {\n    "name": "host114"\n  },\n  "message": "192.168.163.1 - - [15/Jan/2020:03:19:11 +0800] \\"GET /a.html HTTP/1.1\\" 404 555 \\"-\\" \\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36\\" \\"-\\"",\n  "log": {\n    "offset": 0,\n    "file": {\n      "path": ""\n    }\n  }\n}\n...\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br")])]),t("hr"),s._v(" "),t("h2",{attrs:{id:"packetbeat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#packetbeat"}},[s._v("#")]),s._v(" Packetbeat")]),s._v(" "),t("h3",{attrs:{id:"安装-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("版本：7.5.0 Linux 64位"),t("br"),s._v("\n1.上传安装包")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@host114 tool]# rz\n\n[root@host114 tool]# ll\ntotal 561080\n-rw-r--r--. 1 root root 290113992 Jan 13 16:09 elasticsearch-7.5.0-linux-x86_64.tar.gz\n-rw-r--r--  1 root root  24313058 Jan 13 15:34 filebeat-7.5.0-linux-x86_64.tar.gz\n-rw-r--r--. 1 root root 238464690 Jan 13 15:35 kibana-7.5.0-linux-x86_64.tar.gz\n-rw-r--r--  1 root root  21647631 Jan 13 15:39 packetbeat-7.5.0-linux-x86_64.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("2.解压到指定目录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@host114 tool]# tar zxvf packetbeat-7.5.0-linux-x86_64.tar.gz \n[root@host114 tool]# mv packetbeat-7.5.0-linux-x86_64 /usr/local/\n[root@host114 packetbeat-7.5.0-linux-x86_64]# ll\ntotal 65316\n-rw-r--r-- 1 root root   165150 Nov 26 07:50 fields.yml\ndrwxr-xr-x 3 root root       15 Nov 26 07:50 kibana\n-rw-r--r-- 1 root root    13675 Nov 26 07:26 LICENSE.txt\n-rw-r--r-- 1 root root   302830 Nov 26 07:27 NOTICE.txt\n-rwxr-xr-x 1 root root 66308680 Nov 26 07:54 packetbeat\n-rw-r--r-- 1 root root    65652 Nov 26 07:55 packetbeat.reference.yml\n-rw------- 1 root root     8771 Nov 26 07:55 packetbeat.yml\n-rw-r--r-- 1 root root      832 Nov 26 07:55 README.md\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),t("p",[t("strong",[s._v("Packetbeat")]),s._v("用来实时抓取网络包数据，还可以将网络包按照网络协议展开解析。"),t("br"),s._v("\n支持的应用层协议："),t("br"),s._v(" "),t("strong",[s._v("ICMP(IPV4 / IPV6)")]),t("br"),s._v(" "),t("strong",[s._v("DNS")]),t("br"),s._v(" "),t("strong",[s._v("HTTP")]),t("br"),s._v(" "),t("strong",[s._v("MYSQL")]),t("br"),s._v(" "),t("strong",[s._v("REDIS")]),t("br"),s._v(" "),t("strong",[s._v("...")]),t("br")]),s._v(" "),t("h3",{attrs:{id:"实战测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实战测试"}},[s._v("#")]),s._v(" 实战测试")]),s._v(" "),t("p",[s._v("1.创建测试配置文件"),t("br"),s._v(" "),t("strong",[s._v("packetbeat.interfaces.device")]),s._v(" 监听的网卡(linux监听所有-any)"),t("br"),s._v(" "),t("strong",[s._v("packetbeat.protocols.http")]),s._v(" 表示抓取http的包"),t("br"),s._v(" "),t("strong",[s._v("ports")]),s._v(" 监听的端口"),t("br"),s._v(" "),t("strong",[s._v("send_request")]),s._v(" true-开启记录http请求request的内容(body)"),t("br"),s._v(" "),t("strong",[s._v("include_body_for")]),s._v(" 配置数据的筛选条件"),t("br")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@host114 packetbeat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("7.5.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x86_64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi test.yml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#######################################################################")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("packetbeat.interfaces.device")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" any\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("packetbeat.protocols.http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("send_request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("   \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include_body_for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"application/json"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-www-form-urlencoded"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("output.console")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pretty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#######################################################################")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("2.启动Packetbeat"),t("br"),s._v("\n注意：如果你是非root账户启动，请加上sudo借用root权限。 -strict.perms=false是在启动时避免检查\ntest.yml文件的权限。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ sudo ./packetbeat -e -c test.yml -strict.perms=false\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("3.测试一条请求\n首先在kinana里发起一条查询请求，然后在packetbeat控制台查看是否捕捉到请求。\n"),t("img",{attrs:{src:"/images/elkb/packetbeat1.png",alt:""}}),t("br"),s._v("\n如上图，成功捕捉到我们在kibana里面发起的查询请求，日志内容多，就不全部截图了。建议关闭Kibana,\n直接请求elasticsearch测试，或者修改配置捕捉其他请求。Kibana和ES之间监控请求太多，不好观察。")])])}),[],!1,null,null,null);a.default=e.exports}}]);