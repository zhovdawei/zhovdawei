(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{395:function(s,a,e){"use strict";e.r(a);var n=e(42),r=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"私有镜像仓库harbor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#私有镜像仓库harbor"}},[s._v("#")]),s._v(" 私有镜像仓库Harbor")]),s._v(" "),e("hr"),s._v(" "),e("h2",{attrs:{id:"harbor的由来"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#harbor的由来"}},[s._v("#")]),s._v(" Harbor的由来")]),s._v(" "),e("p",[s._v("Habor是由VMWare公司开源的容器镜像仓库。事实上，Habor是在Docker Registry上进行\n了相应的企业级扩展，从而获得了更加广泛的应用，这些新的企业级特性包括：管理用户\n界面，基于角色的访问控制 ，AD/LDAP集成以及审计日志等。")]),s._v(" "),e("h2",{attrs:{id:"准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),e("p",[s._v("我们本次安装harbor以docker-compose的方式部署。"),e("br"),s._v("\nharbor服务器的最低要求2核4G。"),e("br"),s._v("\n准备一台新服务器。"),e("br"),s._v(" "),e("img",{attrs:{src:"/images/docker/harbor1.png",alt:""}}),e("br")]),s._v(" "),e("h2",{attrs:{id:"安装步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤"}},[s._v("#")]),s._v(" 安装步骤")]),s._v(" "),e("h3",{attrs:{id:"_1-上传harbor离线包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-上传harbor离线包"}},[s._v("#")]),s._v(" 1.上传harbor离线包")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/goharbor/harbor/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("harbor安装包下载"),e("OutboundLink")],1),s._v("\n下载最新稳定的离线包，例如：harbor-offline-installer-v1.7.1.tar"),e("br"),s._v("\n上传并解压。"),e("br")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[root@host107 ~]# tar zxvf harbor-offline-installer-v1.7.1.tgz \n[root@host107 harbor]# ll\ntotal 623364\n-rw-r--r-- 1 root root 638288840 Nov 14 19:23 harbor.v1.7.1.tar.gz\n-rw-r--r-- 1 root root      5805 Nov 14 19:23 harbor.yml\n-rwxr-xr-x 1 root root      5088 Nov 14 19:23 install.sh\n-rw-r--r-- 1 root root     11347 Nov 14 19:23 LICENSE\n-rwxr-xr-x 1 root root      1748 Nov 14 19:23 prepare\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h3",{attrs:{id:"_2-安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装docker"}},[s._v("#")]),s._v(" 2.安装docker")]),s._v(" "),e("p",[e("a",{attrs:{href:"/coding/devops/docker/Centos7%E4%B8%8B%E5%AE%89%E8%A3%85docker"}},[s._v("Centos7下安装docker")]),e("br")]),s._v(" "),e("h3",{attrs:{id:"_3-安装docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装docker-compose"}},[s._v("#")]),s._v(" 3.安装docker-compose")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 下载docker-compose\n[root@host107 ~]# sudo curl -L "https://github.com/docker/compose/releases/download/1.25.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\n\n# 给文件加权限\n[root@host107 ~]# sudo chmod +x /usr/local/bin/docker-compose\n\n# 创建软连接\n[root@host107 ~]# sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker-compose官方安装"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"_4-https安全认证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-https安全认证"}},[s._v("#")]),s._v(" 4.https安全认证")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 在harbor目录下，创建一个ssl目录，用户存放证书\n[root@host107 harbor]# mkdir ssl\n[root@host107 harbor]# ll\ntotal 590236\ndrwxr-xr-x 3 root root        23 Dec  5 19:04 common\n-rw-r--r-- 1 root root       939 Jan  4  2019 docker-compose.chartmuseum.yml\n-rw-r--r-- 1 root root       975 Jan  4  2019 docker-compose.clair.yml\n-rw-r--r-- 1 root root      1434 Jan  4  2019 docker-compose.notary.yml\n-rw-r--r-- 1 root root      5608 Jan  4  2019 docker-compose.yml\n-rw-r--r-- 1 root root      8033 Jan  4  2019 harbor.cfg\n-rw-r--r-- 1 root root 603562385 Jan  4  2019 harbor.v1.7.1.tar.gz\n-rwxr-xr-x 1 root root      5739 Jan  4  2019 install.sh\n-rw-r--r-- 1 root root     11347 Jan  4  2019 LICENSE\n-rw-r--r-- 1 root root    748160 Jan  4  2019 open_source_license\n-rwxr-xr-x 1 root root     36337 Jan  4  2019 prepare\n\n\n######################################################################\n# 生成ca.crt\n# 我这里就输入了国家名和common name\n[root@host107 harbor]# openssl req \\\n>    -newkey rsa:4096 -nodes -sha256 -keyout ca.key \\\n>    -x509 -days 365 -out ca.crt\nGenerating a 4096 bit RSA private key\n.......++\n............++\nwriting new private key to 'ca.key'\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:CN                       \nState or Province Name (full name) []:\nLocality Name (eg, city) [Default City]:\nOrganization Name (eg, company) [Default Company Ltd]:\nOrganizational Unit Name (eg, section) []:\nCommon Name (eg, your name or your server's hostname) []:zhoudawei\nEmail Address []:\n\n######################################################################\n# 生成域名请求的证书\n# 注意：depo.zhoudawei.com 就是我们后面要访问的镜像仓库域名\n[root@host107 ssl]# openssl req \\\n> -newkey rsa:4096 -nodes -sha256 -keyout depo.zhoudawei.com.key \\\n> -out depo.zhoudawei.com.csr\n.............................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................++\n........................................................................................................++\nwriting new private key to 'depo.zhoudawei.com.key'\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:CN\nState or Province Name (full name) []:\nLocality Name (eg, city) [Default City]:\nOrganization Name (eg, company) [Default Company Ltd]:\nOrganizational Unit Name (eg, section) []:\nCommon Name (eg, your name or your server's hostname) []:depo.zhoudawei.com\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\n######################################################################\n# 颁发证书\n[root@host107 ssl]# openssl x509 -req -days 365 -in depo.zhoudawei.com.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out depo.zhoudawei.com.crt\nSignature ok\nsubject=/C=CN/L=Default City/O=Default Company Ltd/CN=depo.zhoudawei.com\nGetting CA Private Key\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br")])]),e("h3",{attrs:{id:"_5-配置harbor配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置harbor配置文件"}},[s._v("#")]),s._v(" 5.配置harbor配置文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[root@host107 harbor]# vi harbor.cfg \n############################################################\n# 修改配置文件中的以下key的值\nhostname = depo.zhoudawei.com\n\nui_url_protocol = https\n\nssl_cert = ./ssl/depo.zhoudawei.com.crt\nssl_cert_key = ./ssl/depo.zhoudawei.com.key\n\nharbor_admin_password = 12345\n############################################################\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"_6-执行-prepare"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-执行-prepare"}},[s._v("#")]),s._v(" 6.执行./prepare")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[root@host107 harbor]# ./prepare \nGenerated and saved secret to file: /data/secretkey\nGenerated configuration file: ./common/config/nginx/nginx.conf\nGenerated configuration file: ./common/config/adminserver/env\nGenerated configuration file: ./common/config/core/env\nGenerated configuration file: ./common/config/registry/config.yml\nGenerated configuration file: ./common/config/db/env\nGenerated configuration file: ./common/config/jobservice/env\nGenerated configuration file: ./common/config/jobservice/config.yml\nGenerated configuration file: ./common/config/log/logrotate.conf\nGenerated configuration file: ./common/config/registryctl/env\nGenerated configuration file: ./common/config/core/app.conf\nGenerated certificate, key file: ./common/config/core/private_key.pem, cert file: ./common/config/registry/root.crt\nThe configuration files are ready, please use docker-compose to start the service.\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("h3",{attrs:{id:"_7-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-安装"}},[s._v("#")]),s._v(" 7.安装")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[root@host107 harbor]# ./install.sh\n# 等待一会\n\n# 安装完后，验证运行\n# 可以看到harbor也是类似微服务部署，各模块单独部署一个docker容器\n[root@host107 harbor]# docker-compose ps\n       Name                     Command                       State                                        Ports                              \n----------------------------------------------------------------------------------------------------------------------------------------------\nharbor-adminserver   /harbor/start.sh                 Up (healthy)                                                                            \nharbor-core          /harbor/start.sh                 Up (healthy)                                                                            \nharbor-db            /entrypoint.sh postgres          Up (healthy)            5432/tcp                                                        \nharbor-jobservice    /harbor/start.sh                 Up                                                                                      \nharbor-log           /bin/sh -c /usr/local/bin/ ...   Up (health: starting)   127.0.0.1:1514->10514/tcp                                       \nharbor-portal        nginx -g daemon off;             Up (healthy)            80/tcp                                                          \nnginx                nginx -g daemon off;             Up (healthy)            0.0.0.0:443->443/tcp, 0.0.0.0:4443->4443/tcp, 0.0.0.0:80->80/tcp\nredis                docker-entrypoint.sh redis ...   Up                      6379/tcp                                                        \nregistry             /entrypoint.sh /etc/regist ...   Up (healthy)            5000/tcp                                                        \nregistryctl          /harbor/start.sh                 Up (healthy)   \n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("h2",{attrs:{id:"本机浏览器验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本机浏览器验证"}},[s._v("#")]),s._v(" 本机浏览器验证")]),s._v(" "),e("h3",{attrs:{id:"修改本机hosts文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改本机hosts文件"}},[s._v("#")]),s._v(" 修改本机hosts文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 增加\n192.168.163.107 depo.zhoudawei.com\n\n# 如果是在106虚拟机上访问107，同样的也得在106的hosts里面加\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"浏览器访问harbor后台管理页面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器访问harbor后台管理页面"}},[s._v("#")]),s._v(" 浏览器访问harbor后台管理页面")]),s._v(" "),e("p",[s._v("url:depo.zhoudawei.com"),e("br"),s._v("\nadmin/12345 (配置文件里面已经修改过)"),e("br"),s._v(" "),e("img",{attrs:{src:"/images/docker/harbor2.png",alt:""}}),e("br")]),s._v(" "),e("h3",{attrs:{id:"创建一个项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建一个项目"}},[s._v("#")]),s._v(" 创建一个项目")]),s._v(" "),e("p",[s._v("项目设为私有，保证项目在小范围可见，隔离无关人员的误操作。\n"),e("img",{attrs:{src:"/images/docker/harbor3.png",alt:""}}),e("br")]),s._v(" "),e("h3",{attrs:{id:"创建一个用户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建一个用户"}},[s._v("#")]),s._v(" 创建一个用户")]),s._v(" "),e("p",[s._v("daivd/Harbor2019\n"),e("img",{attrs:{src:"/images/docker/harbor4.png",alt:""}}),e("br")]),s._v(" "),e("h3",{attrs:{id:"为项目指定拥有者-开发者-浏览者"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为项目指定拥有者-开发者-浏览者"}},[s._v("#")]),s._v(" 为项目指定拥有者/开发者/浏览者")]),s._v(" "),e("p",[s._v("这里需要注意的是，账号本身只有管理员和非管理角色。"),e("br"),s._v("\n而在给项目指定用户的同时，又可以为用户指定该项目的权限角色。"),e("br"),s._v("\n这里我们把david指定为拥有mytest项目开发者的权限。"),e("br"),s._v(" "),e("img",{attrs:{src:"/images/docker/harbor5.png",alt:""}}),e("br")]),s._v(" "),e("h2",{attrs:{id:"虚机106上验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#虚机106上验证"}},[s._v("#")]),s._v(" 虚机106上验证")]),s._v(" "),e("h3",{attrs:{id:"证书验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#证书验证"}},[s._v("#")]),s._v(" 证书验证")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 增加域名解析\n[root@host106 ~]# vi /etc/hosts\n#####################################################\n192.168.163.107 depo.zhoudawei.com\n#####################################################\n\n# 创建证书存放目录\n[root@host106 ~]# mkdir /etc/docker/certs.d/depo.zhoudawei.com -p\n# 复制远端107上的文件,需要输入107主机的登录密码\n[root@host106 ~]# scp root@192.168.163.107:/root/harbor/ssl/depo.zhoudawei.com.crt /etc/docker/certs.d/depo.zhoudawei.com\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h3",{attrs:{id:"登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[s._v("#")]),s._v(" 登录")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 输入在harbor后台管理页面上创建的用户/密码\n# 只有登录成功了，在能在登录的主机上往harbor服务上推送镜像和拉取\n[root@host106 ~]# docker login depo.zhoudawei.com\nUsername: david\nPassword: \nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n\n# 免交互登录\n$ docker login -udavid -pHarbor2019 depo.zhoudawei.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h3",{attrs:{id:"往harbor推送镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#往harbor推送镜像"}},[s._v("#")]),s._v(" 往harbor推送镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[root@host106 ~]# docker images\nREPOSITORY                TAG                 IMAGE ID            CREATED             SIZE\ntomcat                    v1                  f32ac73724b3        27 hours ago        619MB\nmysql                     5.7                 1e4405fe1ea9        12 days ago         437MB\ncentos                    7                   5e35e350aded        3 weeks ago         203MB\nbusybox                   latest              020584afccce        5 weeks ago         1.22MB\nricharvey/nginx-php-fpm   latest              bb49f1636b1a        2 months ago        444MB\n\n#####################################################################\n# 这里我测试把tomcat:v1推送到仓库\n# depo.zhoudawei.com是仓库的服务器地址\n# mytest是我们创建项目\n# 上面我们登录的账号是拥有mytest项目开发权限的\n\n# 打上tag\n[root@host106 ~]# docker tag tomcat:v1 depo.zhoudawei.com/mytest/tomcat:v1\n\n# 推送到仓库\n[root@host106 ~]# docker push depo.zhoudawei.com/mytest/tomcat:v1\nThe push refers to repository [depo.zhoudawei.com/mytest/tomcat]\n95d8651dda44: Pushed \n52e4fe2ebe7e: Pushed \n1e55d3f116ba: Pushed \n77b174a6a187: Pushed \nv1: digest: sha256:8ecfbd15bf45da9588b9889ca0e59b129a103152fc7292a7eb90d61a6dca6bd7 size: 1161\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/docker/harbor5.png",alt:""}}),e("br"),s._v("\n我们在后台管理系统也能看到，mytest项目下多了一个镜像。于是，推送镜像成功。")]),s._v(" "),e("h3",{attrs:{id:"从harbor拉取镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从harbor拉取镜像"}},[s._v("#")]),s._v(" 从harbor拉取镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 删除所有tomcat镜像\n[root@host106 ~]# docker images\nREPOSITORY                TAG                 IMAGE ID            CREATED             SIZE\nmysql                     5.7                 1e4405fe1ea9        12 days ago         437MB\ncentos                    7                   5e35e350aded        3 weeks ago         203MB\nbusybox                   latest              020584afccce        5 weeks ago         1.22MB\nricharvey/nginx-php-fpm   latest              bb49f1636b1a        2 months ago        444MB\n\n##############################################################################\n# depo.zhoudawei.com 是我们指定的仓库地址\n# mytest 是指定仓库中的项目\n# tomcat 是镜像名\n# v1 是tag(版本号)\n[root@host106 ~]# docker pull depo.zhoudawei.com/mytest/tomcat:v1\nv1: Pulling from mytest/tomcat\nab5ef0e58194: Already exists \n01d11ddfaf1c: Pull complete \n38618e378a1d: Pull complete \na0a42474496b: Pull complete \nDigest: sha256:8ecfbd15bf45da9588b9889ca0e59b129a103152fc7292a7eb90d61a6dca6bd7\nStatus: Downloaded newer image for depo.zhoudawei.com/mytest/tomcat:v1\ndepo.zhoudawei.com/mytest/tomcat:v1\n\n# 在查看一下本地镜像，从107仓库上拉取镜像就成功了。\n[root@host106 ~]# docker images\nREPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE\ndepo.zhoudawei.com/mytest/tomcat   v1                  f32ac73724b3        28 hours ago        619MB\nmysql                              5.7                 1e4405fe1ea9        12 days ago         437MB\ncentos                             7                   5e35e350aded        3 weeks ago         203MB\nbusybox                            latest              020584afccce        5 weeks ago         1.22MB\nricharvey/nginx-php-fpm            latest              bb49f1636b1a        2 months ago        444MB\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);