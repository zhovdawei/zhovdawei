(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{387:function(s,n,a){"use strict";a.r(n);var e=a(42),r=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"jenkins与k8s的自动化ci-cd流水线实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins与k8s的自动化ci-cd流水线实战"}},[s._v("#")]),s._v(" Jenkins与k8s的自动化CI&CD流水线实战")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"目标流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标流程"}},[s._v("#")]),s._v(" 目标流程")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/cicd/cicd-5.png",alt:""}}),a("br"),s._v("\n一般企业就是上面的流程。"),a("br"),s._v(" "),a("strong",[s._v("开发")]),s._v("：提交代码，推送到Git仓库。"),a("br"),s._v(" "),a("strong",[s._v("测试")]),s._v("：操作Jenkins的流水线任务，完成测试环境发布，验证测试程序。"),a("br"),s._v(" "),a("strong",[s._v("运维")]),s._v("：测试提交镜像号，运维发布生产环境。"),a("br"),s._v(" "),a("strong",[s._v("用户")]),s._v("：用户访问统一LB入口，由LB负载到某个pod上的具体容器，即目标应用程序。"),a("br"),s._v("\n我们这里只需要实现部署到测试环境即可，如果这一次构建的镜像是通过了测试验证。\n发布生产，只需要在生产K8S集群的Dashboard上完成操作就行。这个里面最重要还是\n得到一个满足需求的镜像。")]),s._v(" "),a("h2",{attrs:{id:"节点准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节点准备"}},[s._v("#")]),s._v(" 节点准备")]),s._v(" "),a("p",[s._v("节点可以参考"),a("a",{attrs:{href:"/coding/devops/cicd/Jenkins+Docker%E8%87%AA%E5%8A%A8%E5%8C%96CI&CD%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%AE%9E%E6%88%98"}},[s._v("Jenkins+Docker")]),s._v(" "),a("br"),s._v("\n192.168.163.106-Docker,不需要，因为我们部署K8S集群，由它去分配具体部署的Docker。"),a("br"),s._v("\n另外就是准备K8S集群，我这里是三台机："),a("br"),s._v("\n192.168.163.108_k8s-master"),a("br"),s._v("\n192.168.163.109_k8s-node1"),a("br"),s._v("\n192.168.163.110_k8s-node2"),a("br")]),s._v(" "),a("h3",{attrs:{id:"jenkins访问k8s-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins访问k8s-master"}},[s._v("#")]),s._v(" Jenkins访问k8s-master")]),s._v(" "),a("p",[s._v("我们在Jenkins服务器192.168.163.101上访问k8s-master节点192.168.163.108，需要添加ssh免密登录。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 如果没有先生成\n$ ssh-keygen \n# 查看秘钥\n[root@host101 ~]# cat /root/.ssh/id_rsa.pub \nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDWmSU8L4Rcbp6EtvE6LxSIhpliVGobRdzTOqeSJTM9UDL92FCWm2yNOE/DPVTVzx069gBVo0rHxNCoSOMYkk/wHpBVsMnRyaR88pBztM0BD6yYVUan5SDbc1D0u6R68mB9EKYTiqaq4Aw9vfq2a9AGeeOpDJfMM0GhaR5yGm47YfAH467+RXIaer0mbgMxk/bElOggH8PHB+i+WOGXG6/Q9cgz2EdHi1nOyfK4oIsBXRjsRt2DEibzBrya9nD2xJwTIEpfqYqXjaesVvF2Kp3oXCcKTSWegmMTCcZZl9JcNMY/OuK1xgHl+D6OIPyEWDylYzj6EwI8kFAODogI0g+V root@host101\n\n[root@k8s-master ~]# chmod 700 .ssh/\n[root@k8s-master ~]# chmod 700 .ssh/authorized_keys\n# 编辑文件，并把Jenkins服务器上的秘钥复制进去\n[root@k8s-master ~]# vim .ssh/authorized_keys\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"配置secret对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置secret对象"}},[s._v("#")]),s._v(" 配置Secret对象")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 生成一个secret配置文件\n$ kubectl create secret docker-registry my-harbor \\\n         --docker-server=depo.zhoudawei.com/mytest \\\n         --docker-username=david \\\n         --docker-password='Harbor2019' \\\n         --docker-email=zdw0607@gmail.com --dry-run -o yaml > harbor-secret.yaml\n\n# 查看该文件，data.dockerconfigjson加密了我们的仓库认证信息\n[root@k8s-master ~]# cat harbor-secret.yaml \napiVersion: v1\ndata:\n  .dockerconfigjson: eyJhdXRocyI6eyJkZXBvLnpob3VkYXdlaS5jb20vbXl0ZXN0Ijp7InVzZXJuYW1lIjoiZGF2aWQiLCJwYXNzd29yZCI6IkhhcmJvcjIwMTkiLCJlbWFpbCI6InpkdzA2MDdAZ21haWwuY29tIiwiYXV0aCI6IlpHRjJhV1E2U0dGeVltOXlNakF4T1E9PSJ9fX0=\nkind: Secret\nmetadata:\n  creationTimestamp: null\n  name: my-harbor\ntype: kubernetes.io/dockerconfigjson\n\n        \n# 启动该文件\n[root@k8s-master ~]# kubectl get secret\nNAME                  TYPE                                  DATA   AGE\ndefault-token-2jhfm   kubernetes.io/service-account-token   3      10d\nmy-harbor             kubernetes.io/dockerconfigjson        1      8s\n\n# 在需要镜像认证的地方配置下面的信息\n====================================\nspec:\n  containers:\n  - image: param-image\n    name: param-name\n  imagePullSecrets:\n  - name: my-harbor\n====================================\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("h3",{attrs:{id:"k8s-node1-2访问harbor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-node1-2访问harbor"}},[s._v("#")]),s._v(" k8s-node1/2访问Harbor")]),s._v(" "),a("p",[s._v("两个节点负责具体的容器部署工作，需要从镜像仓库拉取镜像。如果你的Harbor\n是配置的https访问，那么你需要在node1/2上添加凭证。具体的凭证生成请查看\n"),a("a",{attrs:{href:"/coding/devops/docker/%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93Harbor"}},[s._v("Harbor镜像仓库")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@k8s-node2 ~]# vi /etc/hosts\n#####################################################\n192.168.163.107 depo.zhoudawei.com\n#####################################################\n[root@k8s-node2 ~]# mkdir /etc/docker/certs.d/depo.zhoudawei.com -p\n\n[root@k8s-node2 ~]# scp root@192.168.163.107:/root/harbor/ssl/depo.zhoudawei.com.crt /etc/docker/certs.d/depo.zhoudawei.com\nThe authenticity of host '192.168.163.107 (192.168.163.107)' can't be established.\nECDSA key fingerprint is SHA256:Nw2ekiMBaEVdz3FxqabFggQqG0LNIiVRRXa+cd9P+Is.\nECDSA key fingerprint is MD5:2e:af:fe:47:01:60:62:63:c4:fa:dc:14:d6:4e:7f:c9.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '192.168.163.107' (ECDSA) to the list of known hosts.\nroot@192.168.163.107's password: \ndepo.zhoudawei.com.crt                                                                                    100% 1862   972.6KB/s   00:00    \n\n[root@k8s-node2 ~]# docker login -udavid -pHarbor2019 depo.zhoudawei.com\nWARNING! Using --password via the CLI is insecure. Use --password-stdin.\nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h2",{attrs:{id:"jenkins流水线脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins流水线脚本"}},[s._v("#")]),s._v(" Jenkins流水线脚本")]),s._v(" "),a("h3",{attrs:{id:"拉取代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取代码"}},[s._v("#")]),s._v(" 拉取代码")]),s._v(" "),a("p",[s._v("和"),a("a",{attrs:{href:"/coding/devops/cicd/Jenkins+Docker%E8%87%AA%E5%8A%A8%E5%8C%96CI&CD%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%AE%9E%E6%88%98"}},[s._v("Jenkins+Docker")]),s._v("一样")]),s._v(" "),a("h3",{attrs:{id:"编译打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译打包"}},[s._v("#")]),s._v(" 编译打包")]),s._v(" "),a("p",[s._v("和"),a("a",{attrs:{href:"/coding/devops/cicd/Jenkins+Docker%E8%87%AA%E5%8A%A8%E5%8C%96CI&CD%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%AE%9E%E6%88%98"}},[s._v("Jenkins+Docker")]),s._v("一样")]),s._v(" "),a("h3",{attrs:{id:"镜像制作-推送"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像制作-推送"}},[s._v("#")]),s._v(" 镜像制作&推送")]),s._v(" "),a("p",[s._v("和"),a("a",{attrs:{href:"/coding/devops/cicd/Jenkins+Docker%E8%87%AA%E5%8A%A8%E5%8C%96CI&CD%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%AE%9E%E6%88%98"}},[s._v("Jenkins+Docker")]),s._v("一样")]),s._v(" "),a("h3",{attrs:{id:"部署k8s集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署k8s集群"}},[s._v("#")]),s._v(" 部署K8S集群")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('stage(\'部署\') {\n    sh \'\'\'\n        REPOSITORY=depo.zhoudawei.com/mytest/java-web-1:${branch}\n        ssh root@192.168.163.108 "/usr/bin/rm -rf k8s-java |true"\n        ssh root@192.168.163.108 "/usr/bin/mkdir k8s-java"\n        ssh root@192.168.163.108 "/usr/bin/cd k8s-java"\n        \n        # 依次关闭ingress,service,deployment\n        # 重复构建可以利用deployment升级来替换，我这里为了省事就干掉原来的\n        ssh root@192.168.163.108 "/usr/bin/kubectl delete ingress/k8s-java"\n        ssh root@192.168.163.108 "/usr/bin/kubectl delete svc/k8s-java"\n        ssh root@192.168.163.108 "/usr/bin/kubectl delete deploy/k8s-java"\n        \n        # 复制deployment模板，并替换其中的变量值\n        ssh root@192.168.163.108 "/usr/bin/cp /root/deploy-demo.yaml deploy.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s/param-name/k8s-java/g\' deploy.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s/param-num/3/g\' deploy.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s!param-image!$REPOSITORY!g\' deploy.yaml"\n       \n        # 复制service模板，并替换其中的变量值\n        ssh root@192.168.163.108 "/usr/bin/cp /root/svc-demo.yaml svc.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s/param-name/k8s-java/g\' svc.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s/param-port/80/g\' svc.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s/param-target-port/8080/g\' svc.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s/param-type/ClusterIP/g\' svc.yaml"\n        \n        # 复制ingress模板，并替换其中的变量值\n        ssh root@192.168.163.108 "/usr/bin/cp /root/ingress-demo.yaml ingress.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s/param-name/k8s-java/g\' ingress.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s/param-url/k8s.test.com/g\' ingress.yaml"\n        ssh root@192.168.163.108 "/usr/bin/sed -i \'s/param-port/80/g\' ingress.yaml"\n        \n        # 依次启动deployment,service,ingress\n        ssh root@192.168.163.108 "/usr/bin/kubectl apply -f deploy.yaml"\n        ssh root@192.168.163.108 "/usr/bin/kubectl apply -f svc.yaml"\n        ssh root@192.168.163.108 "/usr/bin/kubectl apply -f ingress.yaml"\n        \n    \'\'\'  \n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("p",[a("img",{attrs:{src:"/images/cicd/cicd-6.png",alt:""}}),a("br"),s._v("\n我这里预先在/root/下创建了三个模板文件："),a("br"),s._v("\ndeploy-demo.yaml"),a("br"),s._v("\nsvc-demo.yaml"),a("br"),s._v("\ningress-demo.yaml"),a("br"),s._v("\n我们只需要制定好k8s部署的参数规则，当一个构建过来，我们只需要在脚本里面，复制这三个文件的\n副本，然后替换其中的参数。依次执行就OK了。"),a("br"),s._v(" "),a("a",{attrs:{href:"/coding/devops/kubernetes/Deployment%E6%8E%A7%E5%88%B6%E5%99%A8"}},[s._v("理解Deployment")]),a("br"),s._v(" "),a("a",{attrs:{href:"/coding/devops/kubernetes/Service%E7%BB%9F%E4%B8%80%E8%AE%BF%E9%97%AE%E5%85%A5%E5%8F%A3"}},[s._v("理解Service")]),a("br"),s._v(" "),a("a",{attrs:{href:"/coding/devops/kubernetes/Ingress%E5%AF%B9%E5%A4%96%E6%9A%B4%E9%9C%B2%E5%BA%94%E7%94%A8"}},[s._v("理解Ingress")]),a("br")]),s._v(" "),a("h2",{attrs:{id:"测试一波"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试一波"}},[s._v("#")]),s._v(" 测试一波")]),s._v(" "),a("h3",{attrs:{id:"构建一条龙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建一条龙"}},[s._v("#")]),s._v(" 构建一条龙")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/cicd/jd-4.gif",alt:""}}),a("br"),s._v("\n如上演示，新建一个k8s-java的流水线任务。前面三步没啥可说的。前一篇都说过了。"),a("br"),s._v("\n然后这里需要注意的是部署这个环节的脚本，我写了较多重复参数，优化起来是可以在脚本前面部分，\n把相关参数设置好，后面stage里面的脚本完全可以固定模式，引用前面的变量即可。这样一来，如果\n有新项目要创建人物，我们可以要求他们按照要求填写项目的Git地址，项目名...等参数。这样就可以\n去完成自动化的构建任务了。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 查看deployment,service,ingress的状态\n[root@k8s-master ~]# kubectl get deploy,svc,ingress\nNAME                             READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.extensions/k8s-java   3/3     3            3           2m\ndeployment.extensions/web        2/2     2            2           7d21h\n\nNAME                 TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE\nservice/k8s-java     ClusterIP   10.1.118.49   <none>        80/TCP    2m\nservice/kubernetes   ClusterIP   10.1.0.1      <none>        443/TCP   10d\nservice/web          ClusterIP   10.1.71.141   <none>        80/TCP    6d22h\n\nNAME                          HOSTS          ADDRESS   PORTS   AGE\ningress.extensions/k8s-java   k8s.test.com             80      119s\ningress.extensions/web        test.web.com             80      6d23h\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"浏览器访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器访问"}},[s._v("#")]),s._v(" 浏览器访问")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/cicd/jd-5.gif",alt:""}}),a("br"),s._v("\ningress章节中讲过，域名访问如何配置。这里我们配置的域名是：k8s.test.com")]),s._v(" "),a("h2",{attrs:{id:"小结一下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结一下"}},[s._v("#")]),s._v(" 小结一下")]),s._v(" "),a("p",[s._v("此次我们只是搭建了CI/CD自动化构建流水线任务的主体。比如一些细节，构建失败邮件通知，k8s\n集群监控，elk日志收集...这些都将在往后的学习生涯中总结。总得来说，综合实践，还算顺利。")])])}),[],!1,null,null,null);n.default=r.exports}}]);