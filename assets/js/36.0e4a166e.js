(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{390:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"dockerfile介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile介绍"}},[t._v("#")]),t._v(" Dockerfile介绍")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"dockerfile是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile是什么"}},[t._v("#")]),t._v(" dockerfile是什么")]),t._v(" "),s("p",[t._v("Dockerfile 是一个文本格式的配置文件，用户可以使用Dockerfile来快速创建自定义的镜像。")]),t._v(" "),s("h2",{attrs:{id:"dockerfile指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile指令"}},[t._v("#")]),t._v(" dockerfile指令")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("指令")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("FROM")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("构建的新镜像是基于哪个镜像"),s("br"),t._v("例如：FROM centos:7")])]),t._v(" "),s("tr",[s("td",[t._v("MAINTAINER")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("镜像维护者姓名或邮箱地址"),s("br"),t._v("例如 MAINTAINER xxx@qq.com")])]),t._v(" "),s("tr",[s("td",[t._v("RUN")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("构建镜像时运行的Shell命令"),s("br"),t._v('例如：RUN ["yum","install","httpd"]'),s("br"),t._v("RUN yum install httpd")])]),t._v(" "),s("tr",[s("td",[t._v("CMD")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("运行容器时执行的Shell命令"),s("br"),t._v('例如：CMD ["-c","/start.sh"]'),s("br"),t._v('CMD ["/usr/sbin/sshd","-D"]'),s("br"),t._v("CMD /usr/sbin/sshd -D")])]),t._v(" "),s("tr",[s("td",[t._v("EXPOSE")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("声明容器运行的服务端口"),s("br"),t._v("例如：EXPOSE 80 443")])]),t._v(" "),s("tr",[s("td",[t._v("ENV")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("设置容器内环境变量"),s("br"),t._v("例如：ENV MYSQL_ROOT_PASSWORD 123456")])]),t._v(" "),s("tr",[s("td",[t._v("ADD")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("拷贝文件或目录到镜像,如果是URL或压缩包会自动下载或自动解压 "),s("br"),t._v("ADD '<'src'>'... '<'dest'>' "),s("br"),t._v("ADD [\"'<'src'>'\",...\"'<'dest'>'\"]"),s("br"),t._v("ADD https://xxx.com/html.tar.gz /var/www/html "),s("br"),t._v("ADD html.tar.gz /var/www/html")])]),t._v(" "),s("tr",[s("td",[t._v("COPY")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("拷贝文件或目录到镜像，用法同上"),s("br"),t._v("例如: COPY ./start.sh /start.sh")])]),t._v(" "),s("tr",[s("td",[t._v("ENTRYPOINT")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("运行容器时执行的Shell命令"),s("br"),t._v('例如：ENTRYPOINT ["/bin/bash","-c","/start.sh"]'),s("br"),t._v("ENTRYPOINT /bin/bash -c '/start.sh'")])]),t._v(" "),s("tr",[s("td",[t._v("VOLUME")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("指定容器挂载点到宿主机自动生成的目录或其他容器"),s("br"),t._v('例如：VOLUME ["/var/lib/mysql"]')])]),t._v(" "),s("tr",[s("td",[t._v("USER")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("为RUN、CMD和ENTRYPOINT执行命令指定运行用户"),s("br"),t._v("USER '<'user'>'[:'<'group'>'] or USER '<'UID'>'[:'<'GID'>']"),s("br"),t._v("例如：USER admin")])]),t._v(" "),s("tr",[s("td",[t._v("WORKDIR")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("为RUN、CMD、ENTRYPOINT、COPY和ADD设置工作目录"),s("br"),t._v("例如：WORKDIR /data")])]),t._v(" "),s("tr",[s("td",[t._v("HEALTHCHECK")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("健康检查"),s("br"),t._v("HEALTHECK --interval=5m --timeout=3s --retries=3 \\ "),s("br"),t._v("CMD curl -f http://localhost/ 丨丨 exit 1")])]),t._v(" "),s("tr",[s("td",[t._v("ARG")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("在构建镜像时指定一些参数"),s("br"),t._v("例如：FROM centos:7"),s("br"),t._v("ARG user  # ARG user=root"),s("br"),t._v("USER $user"),s("br"),t._v("# docker build --build-arg user-admin Dockerfile")])])])]),t._v(" "),s("h2",{attrs:{id:"自定义tomcat镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义tomcat镜像"}},[t._v("#")]),t._v(" 自定义Tomcat镜像")]),t._v(" "),s("h3",{attrs:{id:"创建-root-tomcat目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-root-tomcat目录"}},[t._v("#")]),t._v(" 创建/root/tomcat目录")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 上传如下文件到此目录中\n[root@host106 tomcat]# ll\ntotal 198752\n-rw-r--r-- 1 root root   9352747 Aug 10  2017 apache-tomcat-8.0.46.tar.gz\n-rw-r--r-- 1 root root       315 Dec  4 16:00 Dockerfile\n-rw-r--r-- 1 root root 194151339 Oct 22 13:23 jdk-8u231-linux-x64.tar.gz\n-rw-r--r-- 1 root root      6600 Aug 28  2017 server.xml\n# 生产环境容器的JDK是引用宿主机，我们这里先制作一个带有自己JDK的镜像\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h3",{attrs:{id:"配置dockerfile文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置dockerfile文件"}},[t._v("#")]),t._v(" 配置dockerfile文件")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('# dockerfile是创建我们自定义镜像的关键\n###########################################################\n\n# 依赖centos7基础镜像\nFROM centos:7\n# 表明作者信息，这里就给出邮箱\nMAINTAINER zdw0607@gmail.com\n\n# 将宿主机/root/tomcat/下的jdk添加到容器目录/usr/local/，并解压\nADD jdk-8u231-linux-x64.tar.gz /usr/local\n# 设置环境变量 JAVA_HOME\nENV JAVA_HOME /usr/local/jdk1.8.0_231\n\n# 添加宿主机/root/tomcat/下的tomcat压缩包到指定的容器目录中，并解压\nADD apache-tomcat-8.0.46.tar.gz /usr/local\n# 将宿主机/root/tomcat/下的自定义的server.xml文件复制到容器中解压后的tomcat中配置文件目录下\nCOPY server.xml /usr/local/apache-tomcat-8.0.46/conf\n\n# 删除软件包，降低镜像大小\nRUN rm -f /usr/local/*.tar.gz\n\n# 指定工作目录，进入容器就会到这个目录下\nWORKDIR /usr/local/apache-tomcat-8.0.46\n# 声明容器运行的端口\nEXPOSE 8080\n# 容器运行时执行的Shell脚本，其实就是容器运行时启动tomcat(卡塔琳娜)\nENTRYPOINT ["./bin/catalina.sh", "run"]\n\n###########################################################\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br")])]),s("h3",{attrs:{id:"创建镜像tomcat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建镜像tomcat"}},[t._v("#")]),t._v(" 创建镜像tomcat")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('# 在tomcat镜像文件配置目录下，执行命令，这个目录就类似于镜像的组装空间，包含我们镜像文件需要的全部文件\n[root@host106 tomcat]# docker build -t tomcat:v1 .\nSending build context to Docker daemon  203.5MB\nStep 1/10 : FROM centos:7\n7: Pulling from library/centos\nab5ef0e58194: Pull complete \nDigest: sha256:4a701376d03f6b39b8c2a8f4a8e499441b0d567f9ab9d58e4991de4472fb813c\nStatus: Downloaded newer image for centos:7\n ---\x3e 5e35e350aded\nStep 2/10 : MAINTAINER zdw0607@gmail.com\n ---\x3e Running in d722f44faf10\nRemoving intermediate container d722f44faf10\n ---\x3e 72dbbb4d6fe3\nStep 3/10 : ADD jdk-8u231-linux-x64.tar.gz /usr/local\n ---\x3e 8810622abeb5\nStep 4/10 : ENV JAVA_HOME /usr/local/jdk1.8.0_231\n ---\x3e Running in 77825289c8fd\nRemoving intermediate container 77825289c8fd\n ---\x3e c3f38d4e277e\nStep 5/10 : ADD apache-tomcat-8.0.46.tar.gz /usr/local\n ---\x3e eeb94ac3dfc5\nStep 6/10 : COPY server.xml /usr/local/apache-tomcat-8.0.46/conf\n ---\x3e 9f6c112a1352\nStep 7/10 : RUN rm -f /usr/local/*.tar.gz\n ---\x3e Running in bf09eed2de5c\nRemoving intermediate container bf09eed2de5c\n ---\x3e c0a84b9a25ef\nStep 8/10 : WORKDIR /usr/local/apache-tomcat-8.0.46\n ---\x3e Running in b55870de0077\nRemoving intermediate container b55870de0077\n ---\x3e dacd2541fbc5\nStep 9/10 : EXPOSE 8080\n ---\x3e Running in 92a2e559016c\nRemoving intermediate container 92a2e559016c\n ---\x3e f4c757c523b2\nStep 10/10 : ENTRYPOINT ["./bin/catalina.sh", "run"]\n ---\x3e Running in a011a514ba2f\nRemoving intermediate container a011a514ba2f\n ---\x3e f32ac73724b3\nSuccessfully built f32ac73724b3\nSuccessfully tagged tomcat:v1\n\n# 验证本地镜像库中已有刚刚创建的镜像\n[root@host106 tomcat]# docker images\nREPOSITORY                TAG                 IMAGE ID            CREATED             SIZE\ntomcat                    v1                  f32ac73724b3        2 minutes ago       619MB\n\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br")])]),s("h3",{attrs:{id:"创建war包存放目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建war包存放目录"}},[t._v("#")]),t._v(" 创建war包存放目录")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 在运行镜像为一个容器前，我们先为容器创建一个宿主机的war包目录\n# 这个目录将作为数据卷挂载到容器中tomcat/webapps目录\n# 创建/app/webapps/目录\n[root@host106 webapps]# pwd\n/app/webapps\n\n# 上传一个准备好的war包，并解压\n[root@host106 webapps]# ls esm/\nindex.jsp  META-INF  WEB-INF\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("h3",{attrs:{id:"用镜像运行为一个容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用镜像运行为一个容器"}},[t._v("#")]),t._v(" 用镜像运行为一个容器")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('# 指定端口映射，并挂载宿主机war包目录到容器中的tomcat/webapps\n[root@host106 tomcat]# docker run -itd \\\n> --name=tomcat \\\n> -p 8080:8080 \\\n> --mount type=bind,src=/app/webapps/,dst=/usr/local/apache-tomcat-8.0.46/webapps \\\n> tomcat:v1\n\n# 容器已经在运行中\n[root@host106 tomcat]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\n32b4cf0f76fc        tomcat:v1           "./bin/catalina.sh r…"   12 seconds ago      Up 11 seconds       0.0.0.0:8080->8080/tcp   tomcat\n\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("h3",{attrs:{id:"访问war资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问war资源"}},[t._v("#")]),t._v(" 访问war资源")]),t._v(" "),s("p",[t._v("war中就是一个简单springmvc方法：../queryUser"),s("br"),t._v("\n联合宿主机和端口映射的URL：http://192.168.163.106:8080/esm/queryUser"),s("br"),t._v(" "),s("img",{attrs:{src:"/images/docker/docker30.png",alt:""}}),s("br")])])}),[],!1,null,null,null);a.default=e.exports}}]);